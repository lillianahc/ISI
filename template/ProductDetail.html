<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Product Detail</title>
<link rel="stylesheet" href="assets/css/reset.css"/>
<link rel="stylesheet" href="assets/css/bootstrap.css"/>
<link rel="stylesheet" href="assets/css/bootstrap-theme.css"/>
<script src="assets/js/jquery-1.11.0.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>


</head>
{literal} 
<style>
/*--------common---------*/
body { background-color:#f3f3f3;}
#logo{ background:url(assets/images/LOGO.png) no-repeat; background-size:80px; width:80px; height:80px;
	 float:left; margin:15px 0 0 50px;}
#user_action input { color:#FFFFFF; font-size:12px; font-weight:bold; margin:10px 10px 2px 0; }
#banner { width: 1000px; height: 100px; margin: 0 auto; padding:0 12px; text-align:right;
 background: url(assets/images/container.png) repeat-y; }
#user { margin:20px 10px 0 0; cursor:pointer; }
#user input { margin:0;  padding-right:0;}
#pw{position:relative; float:left; top:32px; left:490px; display:none;}
#pw input { color:#333; margin:0; padding:5px;}
.bold{ font-weight:bold; }
a { cursor:pointer;}

#header #categoryList ul li{ text-align:left;}
.navbar-default { background-color: #3e7fdc; border-color: #336cbf;}
#user_action{ width: 980px; margin: 0 auto; text-align:right; }
#container { width: 1000px; min-height: 1515px; margin: 0 auto; padding:0 12px 10px 12px;
 background: url(assets/images/container.png) repeat-y; }

#footer { width: 1000px; height: 80px; margin: 0 auto; padding:0 12px;
 background: url(assets/images/footer.png) repeat-y; }
#footer p{ color:#fff; font-size:12px; text-align:center; margin:20px 0;}

#searchBar { width:800px; height:auto; margin:0 auto;}
#searchBar > div { float:left;}

.vendor { display:none;}

/*-----------product detail------------*/
#container { min-height: 760px; padding-bottom:30px;}
#searchBackground{ border-bottom:1px solid #CCC}
#product_detail { padding:20px 80px; }
#product_detail textarea{ padding:0}
#product_detail #big_group a:hover{ cursor:default; border:1px solid #DDDDDD;}

/*----product pic-----*/
.thumbnail { width:350px; height:340px; display:table-cell; vertical-align:middle; text-align:center; }
.thumbnail img{ max-width:340px; max-height:330px; }
#product_detail > div{ display:inline-block;}
#smallpic_group{ height:330px;}
#smallpic_group > div{ padding:0; width:80px; cursor:pointer; clear:left; margin-bottom:6.5px;}
.smallpic { height:80px; width:80px;}
.smallpic img{ max-width:70px; max-height:70px; }
.pic_focus{ border-color:#39F }


#product_info{ width:340px; margin-left:15px; position:absolute;}
#product_info table { margin-top:10px;}
#product_info tr td { padding-left:5px;  padding-bottom:10px;}
#product_info table tr > td:first-child{ text-align:right; width:110px; vertical-align:top; }
#product_info tr td input[name="price"] { width:85px;}
#product_info #confirmpro { display:none;}

#detail_info{ margin:10px 95px 0 95px; min-height:300px}
#detail_info table{ width:755px; border-collapse:separate; border-spacing:5px 5px; }


/*------inputbox size---------*/
#detail_info tr td:first-child{ padding-right:25px;}
#detail_info tr td input[name="pages"] { width:85px;}


</style>
{/literal} 
<body>

<div id="header">
<nav class="navbar navbar-default navbar-static-top" role="navigation">
  <div id="user_action" >
		<form method="post">
        	<span style=" float:left; margin-left:10px;"><input name="action" type="submit" value="Home"/></span>
			{if !$session}
				<input name="action" type="submit" value="Login" />
				<input name="action" type="submit" value="Register" />	
			{else}
            	{if ($session['user_id']==1)}
                    <span style="color:white" class="glyphicon glyphicon-user">
                        </span><input type="button" value="{$session['account_name']}" />
                    </span>
                    <input name="action" type="submit" value="Pending Orders" />  
                    <input name="action" type="submit" value="On-delivery Orders" />     	
                {else}
                    <span id="user">
                        <span style="color:white" class="glyphicon glyphicon-user">
                            </span><input type="button" value="{$session['account_name']}" />
                            <span style="color:white" class="caret"></span>
                        </span>
                    </span>
                    <span id="pw"><input class="btn btn-default" name="action" type="submit" value="Change Password" /></span>
                    <input name="action" type="submit" value="Shopping Cart" />  
                    <input name="action" type="submit" value="Purchase Tracking" />          
                {/if}
                
                <input name="action" type="submit" value="Logout" />
			{/if}
		</form>
  </div>
</nav>
	<div id="banner">
    <a href="ProductList.php" id="logo"></a>
	<div id="searchBar">
    <div class="row" style="padding:5px 0 5px 30px; margin-top:35px;">
		<form name="condition" action="ProductList.php" method="get">
        <div class="col-lg-6" style="width:700px;">
            <div class="input-group">
                <div id="categoryList" class="input-group-btn">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="text">All Product</span> <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu">
                 	<li><a>All Product</a><input type="hidden" value="0"/></li>
                    {foreach item=record from=$catagoryList}
                    <li><a>{$record['name']}</a><input type="hidden" value="{$record['category_id']}"/></li>
                    {/foreach}              	
                  </ul>
                </div>
              <input name="category" type="hidden" value="{$category}" />
              <input name="search" type="text" class="form-control" placeholder="Search" value="{$word}">
              <span class="input-group-btn">
                <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search" style="margin-right:5px;"></span>Go</button>
              </span>
            </div>
        </div>
        </form>
    </div>
    <div class="vendor" style="padding:5px 0; margin-top:35px;">
    	<form method="post">
    		<button name="action" type="submit" class="btn btn-warning" value="Add Product">Add Product</button>
        </form>
    </div>
    
    </div>
    </div>
</div>

<div id="container">
	<div style=" height:30px; background-color:#f6f6f6; border-bottom:3px solid #2e62ad; border-top:1px solid #f0f0f0;"></div>
    <form id="productForm" method="post">
    {if $productDetailList}
    <input name="book_id" type="hidden" value="{$productDetailList['book_id']}"/>
    <div id="product_detail">
          <div id="big_group" class="col-xs-6 col-md-6" style="width:373.5px; padding-right:6.5px">
            <a class="thumbnail">
              <img id="big_pic" src="" alt="">
            </a>
          </div>
          <div id="smallpic_group">
          {foreach item=record from=$imageList}
              {if $record['thumbnail']==1}
              <div class="col-xs-6 col-md-2" >
                <a class="thumbnail smallpic pic_focus">
                  <img src="assets/product/{$record['name']}.{$record['type']}" alt="">
                </a>
              </div>
              {else}
              <div class="col-xs-6 col-md-2" >
                <a class="thumbnail smallpic">
                  <img src="assets/product/{$record['name']}.{$record['type']}" alt="">
                </a>
              </div>
              {/if}
          {/foreach}   
          </div> 
		
          <div id="product_info">
          	<table width="100%">
            	<tr>
                	<td><span class="bold">Product Name:</span></td>
                    <td class="customer">{$productDetailList['book_name']}</td>
                    <td class="vendor">
                    	<textarea name="productName" class="form-control" rows="3">{$productDetailList['book_name']}</textarea>
                    </td>
                </tr>
                <tr>
                	<td><span class="bold">Category:</span></td>
                    <td class="customer">{$productDetailList['category']}</td>
                    <td id="categoryList" class="vendor">
                        <div class="btn-group">
                          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="text">{$productDetailList['category']}</span> <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="menu">
                            {foreach item=record from=$catagoryList}
                            <li><a>{$record['name']}</a><input type="hidden" value="{$record['category_id']}"/></li>
                            {/foreach}
                          </ul>
                          </ul>
                        </div><input name="category" type="hidden" value="{$productDetailList['category_id']}" />
                    </td>
                </tr>
                <tr>
                	<td><span class="bold">Price:</span></td>
                    <td>${$productDetailList['price']}</td>
                </tr>
                {if ($session['user_id']==1)} 
                <tr>
                	<td></td>
                    <td style="margin-top:15px;">
                   		<div id="editpro">
                        	 <input name="edit" type="button" class="btn btn-warning" value="Edit" style="width:100px;">
                        </div>
                        <div id="confirmpro">
                       		 <input name="confirmEdit" type="submit" class="btn btn-success" value="Submit" style="width:100px;">
                        </div>
                   </td>
                </tr>  
                {else if ($session['user_id'])}
                <form method="post">
                <input name="book_id" type="hidden" value="{$productDetailList['book_id']}"/>
                <tr>
                	<td><span class="bold customer">Quantity:</span></td>
                    <td>
                      <div class="input-group" style="border-spacing:0; width:105px; margin-bottom:5px">
                          <span class="input-group-btn"> 
                            <button name="minus" disabled="disabled" class="btn btn-default" type="button">-</button>
                          </span>             
                          <input name="quantity" style="text-align:center" type="text" class="form-control" value="1">
                          <span class="input-group-btn"> 
                            <button name="add" class="btn btn-default" type="button">+</button>
                          </span>
                      </div>
                      <div style="margin-top:15px;">
                     	 <input name="addCart" onclick="$("input[name='quantity']").blur();" type="submit" class="btn btn-info" value="Add to shopping cart">
                      </div>
                   </td>
                </tr> 
                </form> 
                {/if} 
            </table>
          </div>
	</div>

	{if $success}
	<div id="dialog" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false" style="display:block; margin-top:150px">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Message</h4>
          </div>
          <div class="modal-body">
            {$success}
          </div>
          <div class="modal-footer">
            <button style="padding-left:20px; padding-right:20px" type="button" class="btn btn-primary">OK</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-backdrop fade in"></div>
    {/if}
    

	<div id="detail_info" class="panel panel-info">
              <div style="font-weight:bold" class="panel-heading">
              	<span>Detail Information</span>
              </div>
              <div class="panel-body">
                <table>
                    <tr>
                         <td width="52%">
                            <span class="bold">Publisher:</span>
                            <span class="customer">{$productDetailList['publisher']}</span>
                            <input name="publisher" type="text" class="form-control vendor" value="{$productDetailList['publisher']}">
                         </td>
                         <td>
                            <span class="bold">Publisher city:</span>
                            <span class="customer">{$productDetailList['city']}</span>
                            <input name="city" type="text" class="form-control vendor" value="{$productDetailList['city']}">
                         </td>
                    </tr>
                    <tr>
                         <td>
                            <span class="bold">Authors:</span>
                            <span class="customer">{$productDetailList['authors']}</span>
                            <input name="authors" type="text" class="form-control vendor" value="{$productDetailList['authors']}">
                         </td>
                         <td>
                            <span class="bold">ISBN:</span>
                            <span class="customer">{$productDetailList['ISBN']}</span>
                            <input name="ISBN" type="text" class="form-control vendor" value="{$productDetailList['ISBN']}">
                         </td>
                    </tr>
                    <tr>
                         <td>
                            <span class="bold">Release date:</span>
                            <span class="customer">{$productDetailList['releaseDate']}</span>
                            <input name="ReleaseDate" type="text" class="form-control vendor" value="{$productDetailList['releaseDate']}">
                         </td>
                         
                    	 <td class="customer">
                            <span class="bold">Language:</span>
                            <span class="customer">{$productDetailList['language']}</span>
                         </td>
                         <td id="languageList" class="vendor">
                            <span class="bold">Language:</span>
                            <p>
                            <div class="btn-group">
                              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="text">{$productDetailList['language']}</span> <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu" role="menu">
                                {foreach item=record from=$languageList}
                                <li><a>{$record['name']}</a><input type="hidden" value="{$record['language_id']}"/></li>
                                {/foreach}
                              </ul>
                            </div><input name="language" type="hidden" value="{$productDetailList['language_id']}" />
                            </p>
                         </td>
                    </tr>
                    <tr>
                     <td>
                     	<span class="bold">Pages:</span>
                        <span class="customer">{$productDetailList['pages']}</span>
                        <input name="pages" type="text" class="form-control vendor" value="{$productDetailList['pages']}">
                     </td>
                     <td></td>
                    </tr>
                    <tr>
                     <td style="padding-right:0" colspan="2">
                     	<span class="bold">Other description:</span>
                        <p class="customer">　　{$productDetailList['description']}</p>
                        <textarea name="otherDes" class="form-control vendor" rows="6">{$productDetailList['description']}</textarea>
                     </td>
                    </tr>
                </table>
              </div>
	</div>	
    {/if}
    {if $error}
    	<p style="padding:20px;">{$error}</p>
    {/if}
    </form>
</div>

<div id="footer">
    <div style=" border-top:5px solid #A2C9EA; margin: 0 auto; width:976px" >
    	<p>Copyright © 2014 Bookstore Inc. All rights reserved</p>
    </div>
</div>


{if ($session['user_id']==1)}
<script language="javascript">

$('input[name=edit]').click(function(){
	$('.vendor').css('display', 'block');
	$('.customer').css('display', 'none');
	$('#editpro').css('display','none');
	$('#confirmpro').css('display', 'block');
})

/*submit*/
$('#productForm').submit(function(e) {  
	$("input").blur();
	$("textarea").blur(); 
	if($("form span.warning").size() > 0){
		return false;
	}
	$("button[type='submit']").css('disabled','disabled');
}); 
</script>
{/if}

{literal} 
<script language="javascript">
$(document).ready(function(){
/*close dialog*/
$('#dialog button').click(function(){
	$('.in').css('display','none');	
	$('.in').removeClass('in');	
	$('#dialog').attr('aria-hidden','true');
})
	
/*user change pw*/
$('#user').hover(function(e){
	$('#pw').css('display','inline');
});
$('input[name=action]').hover(function(e){
	if ($(this).val() != "Change Password")
		$('#pw').css('display','none');
});
$('#pw').mouseleave(function(e){
	$('#pw').css('display','none');
});

$('#big_pic').attr('src', $('.smallpic').eq(0).find('img').attr('src'));
 
/*img size*/
$('img').each(function(index, element) {
	var ie = !-[1,];
	if(ie && $(element).width() > $(element).height()){
		$(element).css('width','100%');
	}
});

/*picture group*/
var clicke = 0;
var bigpic = $('#big_pic').attr('src');
$('.smallpic').click(function(e){
	clicke = 1;
	$('#big_pic').attr('src', $(this).find('img').attr('src'));
	bigpic = $('#big_pic').attr('src');
	$('.smallpic').removeClass('pic_focus');
	$(this).addClass('pic_focus');
	
	if ($(this).find('img').width() <= $(this).find('img').height()){
		$('#big_pic').css('width','auto');
	}else{
		$('#big_pic').css('width','100%');
	}
})
$('.smallpic').hover(function(e){
	$('#big_pic').attr('src', $(this).find('img').attr('src'));
	
	if ($(this).find('img').width() <= $(this).find('img').height()){
		$('#big_pic').css('width','auto');
	}else{
		$('#big_pic').css('width','100%');
	}
})
$('#smallpic_group').mouseleave(function(e){
	if(clicke !=1){
		$('#big_pic').attr('src', bigpic);
		
		if ($(this).find('img').width() <= $(this).find('img').height()){
			$('#big_pic').css('width','auto');
		}else{
			$('#big_pic').css('width','100%');
		}
	}else{
		clicke = 0;
	}
})

/*dropdown list*/
$('#searchBar #categoryList ul li').click(function(){
	$('#searchBar #categoryList button .text').text($(this).find('a').text());
	$("#searchBar input[name='category']").val($(this).find('input').val());
})

$('#product_info #categoryList ul li').click(function(){
	$('#product_info #categoryList button .text').text($(this).find('a').text());
	$("#product_info input[name='category']").val($(this).find('input').val());
})

$('#languageList ul li').click(function(){
	$('#languageList button .text').text($(this).find('a').text());
	$("input[name='language']").val($(this).find('input').val());
})



/*product quantity*/
$('input[name=quantity]').change(function(e){
	var qty = parseInt($(this).val());
	if (qty>1){
		$('#product_info button[name=minus]').removeAttr('disabled');
	}else{
		$('#product_info button[name=minus]').attr('disabled','disabled');
	}
	if (qty<99){
		$('#product_info button[name=add]').removeAttr('disabled');
	}else{
		$('#product_info button[name=add]').attr('disabled','disabled');
	}	
});

$('#product_info button[name=minus]').click(function(e){
	var qty = parseInt($('input[name=quantity]').val());
	if (qty>1){
		$('input[name=quantity]').val(qty-1);
	}
	if (qty-1 <= 1) $('#product_info button[name=minus]').attr('disabled','disabled');
	$('#product_info button[name=add]').removeAttr('disabled');
});

$('#product_info button[name=add]').click(function(e){
	var qty = parseInt($('input[name=quantity]').val());
	$('input[name=quantity]').val(qty+1);
	if (qty+1 >= 99) $('#product_info button[name=add]').attr('disabled','disabled');
	$('#product_info button[name=minus]').removeAttr('disabled');
});

/*checking*/
var product_info = {
	productName: 'Please enter product name',
	price: 'Please enter price',
	image: 'Please upload at least one image',
	publisher: 'Please enter publisher',
	city: 'Please enter publisher city',
	authors: 'Please enter authors',
	ISBN: 'Please enter ISBN',
	ReleaseDate: 'Please enter Release date',
	pages: 'Please enter pages',
}
function checkInput(name, errormsg){
	$('input[name='+ name +']+span').remove();
	if ($.trim($('input[name='+ name +']').val()) == "" ) {
		$('input[name='+ name +']').after("<span class='warning'>"+ errormsg +"</span>");
	}
};

$("input").blur(function(e){
	var name = $(this).attr('name'); 
	var errormsg = product_info[name];
	if (product_info[name]){
		checkInput(name, errormsg);
	}
});

$("input[name='price']").blur(function(e){
	if ($.trim($("input[name='price']").val()) != "" ){
		$("input[name='price']+span").remove();	
		var num = /^\d{1,}(\.\d{1,2})?$/;	
		if (!num.test($.trim($("input[name='price']").val()))){
			$(this).after("<span class='warning'>Invalid number format.</span>");			
		}else{
			var num1 = /^\d{1,}$/;	
			if (num1.test($.trim($("input[name='price']").val())))
				$(this).val($(this).val()+'.00');	
			var num2 = /^\d{1,}(\.\d{1})$/;	
			if (num2.test($.trim($("input[name='price']").val())))
				$(this).val($(this).val()+'.0');
		}
	}
});

$("input[name='ISBN']").blur(function(e){
	if ($.trim($("input[name='ISBN']").val()) != "" ){
		$("input[name='ISBN']+span").remove();	
		var ISBN = /^(\d{10}|\d{13}|\d{3}\-\d{5}\-\d{1}-\d{1}|\d{3}\-\d{3}\-\d{5}\-\d{1}-\d{1})$/;	
		if (!ISBN.test($.trim($("input[name='ISBN']").val()))){
			$(this).after("<span class='warning'>Invalid ISBN format.</span>");			
		}else{
			$("input[name='ISBN']").val($("input[name='ISBN']").val().replace(/\-/g,''));
		}
	}
});

$("input[name='ReleaseDate']").blur(function(e){
	if ($.trim($("input[name='ReleaseDate']").val()) != "" ){
		$("input[name='ReleaseDate']+span").remove();	
		var date = /^\d{4}\-[01]?[0-2]\-([0-2]?[0-9]|[3][01])$/;	
		if (!date.test($.trim($("input[name='ReleaseDate']").val()))){
			$(this).after("<span class='warning'>Invalid date format.</span>");			
		}
	}
});

$("input[name='pages']").blur(function(e){
	if ($.trim($("input[name='pages']").val()) != "" ){
		$("input[name='pages']+span").remove();	
		var num = /^\d{0,5}$/;	
		if (!num.test($.trim($("input[name='pages']").val()))){
			$(this).after("<span class='warning'>Invalid number format.</span>");			
		}
	}
});

$("input[name='quantity']").blur(function(e){
	if ($.trim($(this).val()) != "" ){
		var num = /^\d*$/;	
		if (!num.test($.trim($(this).val()))){
			$(this).val(1);
		}else{
			$(this).val(parseInt($.trim($(this).val())));
			if ($(this).val()<=0){
				$(this).val(1);
			}else if($(this).val()>99){
				$(this).val(99);
			}
		}
	}else{
		$(this).val(1);
	}
	$('input[name=quantity]').change();
});
})
</script>
{/literal} 



</body>
</html>
